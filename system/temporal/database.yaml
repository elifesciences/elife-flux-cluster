---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: temporal-database
  namespace: temporal

spec:
  interval: 1m
  releaseName: temporal-database
  chart:
    spec:
      chart: pxc-db
      version: 1.14.3
      sourceRef:
        kind: HelmRepository
        name: percona
        namespace: db-operator-system
      interval: 1m

  values:
    backup:
      enabled: false
    pxc:
      resources:
        requests:
          memory: 1400Mi
          cpu: 200m
      persistence:
        storageClass: csi-ebs-gp3
        size: 60Gi
      readinessProbes:
        initialDelaySeconds: 300
        failureThreshold: 10
      livenessProbes:
        initialDelaySeconds: 300
        failureThreshold: 10
      nodeSelector:
        Project: ${cluster_name}
    haproxy:
      annotations:
        cluster-autoscaler.kubernetes.io/safe-to-evict: "true"
      resources:
        requests:
          memory: 100Mi
          cpu: 170m
      nodeSelector:
        Project: ${cluster_name}
