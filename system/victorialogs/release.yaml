apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: victorialogs
spec:
  releaseName: victorialogs
  chart:
    spec:
      chart: victoria-logs-single
      sourceRef:
        kind: HelmRepository
        name: victoriametrics
      version: "0.11.24"
  interval: 1h0m0s
  values:
    server:
      retentionPeriod: 30d
      resources:
        requests:
          cpu: 150m
          memory: 850Mi
      persistentVolume:
        enabled: true
        storageClassName: ebs-st1
        size: 200Gi
      ingress:
        enabled: true
        ingressClassName: traefik
        annotations:
          cert-manager.io/cluster-issuer: "letsencrypt"
          traefik.ingress.kubernetes.io/router.middlewares: traefik-elife-oauth@kubernetescrd
        hosts:
          - name: victorialogs.${cluster_domain}
            path: /select
            port: http
        tls:
          - secretName: victorialogs-tls
            hosts:
              - victorialogs.${cluster_domain}
    fluent-bit:
      enabled: false
