apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
  name: temporal
  namespace: epp--staging
spec:
  interval: 1m0s
  sourceRef:
    kind: GitRepository
    name: flux-system
    namespace: flux-system
  path: ./kustomizations/services/temporal
  prune: true
  targetNamespace: epp--staging
  postBuild:
    substitute:
      app_env: staging
      ui_hostname: staging--epp.elifesciences.org
      ui_path: /temporal(/|$)(.*)
  patches:
  - target: Ingress
    name: temporal
    patch: |
      apiVersion: networking.k8s.io/v1
      kind: Ingress
      metadata:
        name: temporal
        annotation:
          nginx.ingress.kubernetes.io/rewrite-target: /$2
