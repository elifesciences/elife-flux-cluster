kubernetesPipelines:

  - dataPipelineId: 'Elife_Article_Xml_Pipeline_Kubernetes'
    airflow:
      dagParameters:
        schedule: null
    image: 'docker.io/elifesciences/data-hub-core-dags:latest'
    imagePullPolicy: Always
    arguments: 
      - 'python'
      - '-m'
      - 'data_pipeline.elife_article_xml.cli'
    env:
      - name: DEPLOYMENT_ENV
        value: '{ENV}'
      - name: ELIFE_ARTICLE_XML_CONFIG_FILE_PATH
        value: /dag_config_files/elife-article-xml.config.yaml
      - name: GITHUB_API_AUTHORIZATION_FILE_PATH
        value: /dag_secret_files/github_api/github_api_authorization.txt
      - name: GOOGLE_APPLICATION_CREDENTIALS
        value: /dag_secret_files/gcloud/credentials.json
    volumeMounts: # need to replicate secret volume to test locally
      - name: github-api-secret-volume
        mountPath: /dag_secret_files/github_api/
        readOnly: true
      - name: gcloud-secret-volume
        mountPath: /dag_secret_files/gcloud/
        readOnly: true
      - name: data-hub-config-volume
        mountPath: /dag_config_files/
        readOnly: true
    volumes:
      - name: github-api-secret-volume
        secret:
          secretName: github-api
      - name: gcloud-secret-volume
        secret:
          secretName: gcloud
      - name: data-hub-config-volume
        configMap:
          name: data-hub-configs
    resources:
      limits:
        memory: 1Gi
        cpu: 1000m
      requests:
        memory: 1Gi
        cpu: 100m

  - dataPipelineId: 'Extract_Keywords_From_Corpus_Kubernetes'
    airflow:
      dagParameters:
        schedule: null
    image: 'docker.io/elifesciences/peerscout-dags:latest'
    imagePullPolicy: Always
    arguments: 
      - 'python'
      - '-m'
      - 'peerscout.cli'
    env:
      - name: DEPLOYMENT_ENV
        value: '{ENV}'
      - name: EXTRACT_KEYWORDS_FILE_PATH
        value: /dag_config_files/keyword-extraction-data-pipeline.config.yaml
      - name: GOOGLE_APPLICATION_CREDENTIALS
        value: /dag_secret_files/gcloud/credentials.json
      - name: AWS_CONFIG_FILE
        value: /dag_secret_files/aws/credentials
    volumeMounts:
      - name: gcloud-secret-volume
        mountPath: /dag_secret_files/gcloud/
        readOnly: true
      - name: aws-secret-volume
        mountPath: /dag_secret_files/aws
        readOnly: true
      - name: data-hub-config-volume
        mountPath: /dag_config_files/
        readOnly: true
    volumes:
      - name: gcloud-secret-volume
        secret:
          secretName: gcloud
      - name: aws-secret-volume
        secret:
          secretName: credentials
      - name: data-hub-config-volume
        configMap:
          name: data-hub-configs
    resources:
      requests:
        memory: 4.9Gi
        cpu: 1495m
        ephemeral-storage: 6Gi
      limits:
        memory: 6Gi
        cpu: 1700m
